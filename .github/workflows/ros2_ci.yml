name: ROS 2 CI

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  ros_ci:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        ros_distro: [humble]

    steps:
      # 1ï¸âƒ£ Checkout repository
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2ï¸âƒ£ Setup ROS 2
      - name: âš™ï¸ Setup ROS 2
        uses: ros-tooling/setup-ros@v0.7
        with:
          ros-distro: ${{ matrix.ros_distro }}

      # 3ï¸âƒ£ Build, Test & Lint (ALL packages inside src/)
      - name: ğŸ—ï¸ Build, Test, and Lint ROS 2 Packages
        uses: ros-tooling/action-ros-ci@v0.4
        with:
          target-ros2-distro: ${{ matrix.ros_distro }}


      # 4ï¸âƒ£ Optional custom linters (repo-relative paths only)
      - name: ğŸ“ Custom Code Quality Checks
        run: |
          echo "Optional custom linters"
          # flake8 src/
          # cppcheck --enable=all --inconclusive --std=c++17 src/

      # 5ï¸âƒ£ Upload logs (NO hard-coded paths)
      - name: ğŸ“¦ Upload Test Results & Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.ros_distro }}-ci-logs
          path: log/
